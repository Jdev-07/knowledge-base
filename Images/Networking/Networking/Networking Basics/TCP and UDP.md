Transport Layer Protocols 

## TCP

More reliable.
Needs to maintain an active connection client - server.
Acknowledgement of receipt of packets  
It establishes sessions with a three -way handshake.
## UDP 

User Datagram Protocol

Much faster.

# Port Numbers

## TCP and UDP port numbers

There are many services that we access through the internet in the course of a day. DNS, web, email, FTP, IM and VoIP are just some of these services that are provided by client/server systems around the world. These services may be provided by a single server or by several servers in large data centers.

When a message is delivered using either TCP or UDP, the protocols and services requested are identified by a port number, as shown in the figure. **A port is a numeric identifier** within each segment that is used to keep track of specific conversations between a client and server. Every message that a host sends contains both a source and destination port.

![[network-015.png]]


When a message is received by a server, it is necessary for the server to be able to determine which service is being request by the client. Clients are preconfigured to use a destination port that is registered on the internet for each service. An example of this is a web browser clients which are preconfigured to send request to web server using the port 80, the well known port for the HTTP web services.

Ports are assigned and managed by an organization known as the Internet Corporation for Assigned Names and Numbers (ICANN). Ports are broken into three categories and range in number from 1 to 65,535

* Well-known ports: Destination ports that are associated with common network applications are  identified as well-kwon ports. These ports are in the range of 1 to 1023. 
* Registered ports: Ports 1024 through 49151 can be used as either source or destination ports. These can be used by organizations to register specific apps such as IM apps
* Private ports - Ports 49152 through 65535 are often used as source ports. These ports can be used by any app.
Below there is a table with most common well-known ports

![[network-016.png]]

Some apps may use both TCP and UDP. For example, DNS uses UDP when clients send requests to a DNS server. However, communication between two DNS servers always uses TCP.

## Socket pairs

The source and destination ports are placed within the segment. The segments are then encapsulated within an IP packet. The IP packet contains the IP address of the source and destination. The combination of the source IP address and source port number, or the destination IP address and destination port number is known as a socket.

In the example in the figure, the PC is simultaneously requesting FTP and web services from the destination server.

![[network-017.png]]

In the example, the FTP request generated by the PC includes the Layer 2 MAC addresses and the Layer 3 IP addresses. The request also identifies the source port number 1305 (dynamically generated by the host) and destination port, identifying the FTP services on port 21. The host also has requested a web page from the server using the same Layer 2 and Layer 3 addresses. However, it is using the source port number 1099 (dynamically generated by the host) and destination port identifying the web service on port 80.

**The socket is used to identify the server and service** being requested by the client. A client socket might look like this, with 1099 representing the source port number: 192.168.1.5:1099

The socket on a web server might be 192.168.1.7:80

Together, these two sockets combine to form a socket pair: 192.168.1.5:1099, 192.168.1.7:80

Sockets enable multiple processes, running on a client, to distinguish themselves from each other, and multiple connections to a server process to be distinguished from each other.

The source port number acts as a return address for the requesting application. The transport layer keeps track of this port and the application that initiated the request so that when a response is returned, it can be forwarded to the correct application.

## netstat 

Unexplained TCP connections can pose a major security threat. They can indicate that something or someone is connected to the local host. Sometimes it is necessary to know which active TCP connections are open and running on a networked host. Netstat is an important network utility that can be used to verify those connections. As shown below, enter the command **netstat** to list the protocols in use, the local address and port numbers, the foreign address and port numbers, and the connection state.

![[network-018.png]]


By default, the **netstat** command will attempt to resolve IP addresses to domain names and port numbers to well-known applications. The **-n** option can be used to display IP addresses and port numbers in their numerical form.